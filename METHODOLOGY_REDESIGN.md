# План переработки методики расчёта нормативов ИТР

## Проблемы текущей методики

### 1. Статистические проблемы
- **Единый норматив на все должности** — не учитывает специфику работы
- **Среднее арифметическое vs медиана** — разница 15.35 vs 9.62 говорит о выбросах
- **Не учитывается масштаб проекта** — малый проект ≠ крупный проект
- **Нет условных факторов** — все должности считаются безусловно

### 2. Методологические проблемы
- Отсутствует обоснование нормативов
- Нет разделения на обязательные и опциональные должности
- Не учитывается сезонность и фаза проекта

---

## Полный список должностей из данных (12 групп)

| № | Группа должностей | Категория | Условие |
|---|-------------------|-----------|---------|
| 1 | **Руководитель проекта** | 🟢 Обязательная | Всегда 1 на проект |
| 2 | **Производитель работ** | 🟢 Обязательная | По численности рабочих |
| 3 | **Мастер** | 🟢 Обязательная | По численности рабочих |
| 4 | **Специалист по охране труда** | 🟢 Обязательная | По законодательству (1 на 50 чел) |
| 5 | **Специалист по общим вопросам / Административный работник** | 🟢 Обязательная | По численности ИТР |
| 6 | **Кладовщик / Работник склада / Специалист ОМТС** | 🟢 Обязательная | По объёму материалов |
| 7 | **Водитель / Машинист / Механик** | 🟡 Условная | ❓ Есть ли автотранспорт на проекте? |
| 8 | **Инспектор строительных лесов** | 🟡 Условная | ❓ Используются ли строительные леса? |
| 9 | **Специалист по сопровождению групп** | 🟡 Условная | ❓ Привлекаются ли иностранные рабочие? |
| 10 | **Сотрудник службы безопасности** | 🟡 Условная | ❓ Требуется ли охрана объекта? |
| 11 | **Инженер-конструктор / Техник-конструктор** | 🟡 Условная | ❓ Есть ли проектные работы на площадке? |
| 12 | **Инструктор / Преподаватель** | 🔴 Исключаемая | Не входит в расчёт ИТР |

---

## Предлагаемая архитектура новой методики

### Уровень 1: Классификация должностей

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         ВСЕ ДОЛЖНОСТИ ИТР (12 групп)                    │
├─────────────────────────────────────────────────────────────────────────┤
│  🟢 ОБЯЗАТЕЛЬНЫЕ (6)              │  🟡 УСЛОВНЫЕ (5)                    │
│  ────────────────────             │  ─────────────────                  │
│  • Руководитель проекта           │  • Водитель/Машинист/Механик        │
│  • Производитель работ            │    → если есть автотранспорт        │
│  • Мастер                         │  • Инспектор строительных лесов     │
│  • Специалист по охране труда     │    → если используются леса         │
│  • Специалист по общим вопросам   │  • Специалист по сопровождению групп│
│  • Кладовщик/Специалист ОМТС      │    → если иностранные рабочие       │
│                                   │  • Сотрудник службы безопасности    │
│                                   │    → если требуется охрана          │
│                                   │  • Инженер-конструктор              │
│                                   │    → если есть проектные работы     │
├─────────────────────────────────────────────────────────────────────────┤
│  🔴 ИСКЛЮЧАЕМЫЕ (1)                                                     │
│  • Инструктор / Преподаватель — НЕ ВХОДИТ в расчёт нормативов ИТР      │
└─────────────────────────────────────────────────────────────────────────┘
```

### Уровень 2: Факторы влияния

| Фактор | Влияние | Как учитывать |
|--------|---------|---------------|
| Масштаб проекта | Высокое | Категории: S/M/L/XL с разными коэффициентами |
| Тип работ | Высокое | Строительство, монтаж, отделка и т.д. |
| Использование техники | Среднее | Наличие/отсутствие автопарка |
| Иностранные рабочие | Среднее | Нужен ли спец. по сопровождению |
| Вахтовый метод | Среднее | Нужны ли спец. по общежитиям |
| Фаза проекта | Низкое | Подготовка/активная фаза/завершение |

---

## Современные статистические методы

### 1. Регрессионный анализ
Вместо простого среднего использовать **множественную регрессию**:

```
ITR_позиция = β₀ + β₁×(Рабочие) + β₂×(Масштаб) + β₃×(Тип_работ) + ε
```

**Преимущества:**
- Учитывает несколько факторов одновременно
- Показывает значимость каждого фактора (p-value)
- Даёт доверительные интервалы

### 2. Квантильная регрессия
Для устойчивости к выбросам использовать **медианную регрессию (50-й квантиль)**:

```python
# Пример на Python
from statsmodels.regression.quantile_regression import QuantReg
model = QuantReg(y, X).fit(q=0.5)  # Медиана
```

### 3. Кластерный анализ
Автоматически выявить группы похожих проектов:

```
Кластер 1: Малые проекты (до 50 рабочих) — минимальный ИТР
Кластер 2: Средние проекты (50-200 рабочих) — стандартный ИТР
Кластер 3: Крупные проекты (200+ рабочих) — расширенный ИТР
```

### 4. Байесовский подход
Для должностей с малым количеством наблюдений:

```
Prior: Экспертная оценка (1 инженер на 30 рабочих)
Likelihood: Фактические данные
Posterior: Уточнённый норматив
```

---

## Структура условных вопросов

### Интерфейс калькулятора (новый)

```
┌─────────────────────────────────────────────────────────────────────┐
│  БАЗОВЫЕ ПАРАМЕТРЫ                                                  │
├─────────────────────────────────────────────────────────────────────┤
│  Название проекта: [_______________________]                        │
│  Численность рабочих: [_____]                                       │
│  Масштаб проекта: ○ Малый ○ Средний ○ Крупный ○ Очень крупный       │
│  Тип работ: □ Строительство □ Монтаж □ Изоляция □ Другое           │
├─────────────────────────────────────────────────────────────────────┤
│  УСЛОВНЫЕ ФАКТОРЫ (влияют на расчёт условных должностей)            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  1. АВТОТРАНСПОРТ                          → Водители/Механики      │
│     Используется ли автотранспорт?     ○ Да ○ Нет                   │
│     → Если да: количество единиц техники [___]                      │
│                                                                     │
│  2. СТРОИТЕЛЬНЫЕ ЛЕСА                      → Инспектор лесов        │
│     Используются ли строительные леса? ○ Да ○ Нет                   │
│     → Если да: общая площадь лесов (м²) [_____]                     │
│                                                                     │
│  3. ИНОСТРАННЫЕ РАБОЧИЕ                    → Спец. по сопровождению │
│     Привлекаются ли иностранные рабочие? ○ Да ○ Нет                 │
│     → Если да: количество человек [___]                             │
│     → Страна происхождения: □ СНГ □ Индия □ Вьетнам □ Другое       │
│                                                                     │
│  4. ОХРАНА ОБЪЕКТА                         → Служба безопасности    │
│     Требуется ли охрана объекта?       ○ Да ○ Нет                   │
│     → Если да: количество постов [___]                              │
│     → Круглосуточно? ○ Да ○ Нет                                     │
│                                                                     │
│  5. ПРОЕКТНЫЕ РАБОТЫ                       → Инженер-конструктор    │
│     Выполняются ли проектные работы на площадке? ○ Да ○ Нет         │
│                                                                     │
├─────────────────────────────────────────────────────────────────────┤
│  ⚠️  ИСКЛЮЧЕНО ИЗ РАСЧЁТА                                           │
│  • Инструкторы и преподаватели — НЕ учитываются в нормативе ИТР    │
└─────────────────────────────────────────────────────────────────────┘
```

---

## Формулы расчёта (предложение)

### 🟢 Обязательные должности (6 групп)

| № | Должность | Формула | Мин | Комментарий |
|---|-----------|---------|-----|-------------|
| 1 | Руководитель проекта | 1 на проект | 1 | Всегда 1, независимо от размера |
| 2 | Производитель работ | ceil(Рабочие / K_прораб[масштаб]) | 1 | K зависит от масштаба проекта |
| 3 | Мастер | ceil(Рабочие / K_мастер[масштаб]) | 1 | K зависит от масштаба проекта |
| 4 | Специалист по охране труда | ceil(Рабочие / 50) | 1 | По законодательству РФ |
| 5 | Специалист по общим вопросам | ceil(Всего_ИТР / 15) | 1 | Административная поддержка |
| 6 | Кладовщик / Специалист ОМТС | ceil(Рабочие / K_склад[тип_работ]) | 1 | Зависит от объёма материалов |

### 🟡 Условные должности (5 групп)

| № | Должность | Условие | Формула |
|---|-----------|---------|---------|
| 7 | Водитель / Машинист / Механик | Автотранспорт = ✅ Да | ceil(Кол-во_техники / 3) |
| 8 | Инспектор строительных лесов | Строит_леса = ✅ Да | ceil(Площадь_лесов / 1000) |
| 9 | Специалист по сопровождению групп | Иностранцы = ✅ Да | ceil(Кол-во_иностранцев / 100) |
| 10 | Сотрудник службы безопасности | Охрана = ✅ Да | Кол-во_постов × (Круглосуточно ? 4 : 2) |
| 11 | Инженер-конструктор | Проект_работы = ✅ Да | ceil(Рабочие / 100) |

### 🔴 Исключаемые должности (1 группа)

| № | Должность | Причина исключения |
|---|-----------|-------------------|
| 12 | Инструктор / Преподаватель | Обучение — отдельный процесс, не относится к производственному ИТР |

### Коэффициенты по масштабу (K)

| Масштаб | K_прораб | K_пто | Описание |
|---------|----------|-------|----------|
| Малый (S) | 15 | 25 | До 50 рабочих |
| Средний (M) | 20 | 30 | 50-200 рабочих |
| Крупный (L) | 25 | 40 | 200-500 рабочих |
| Очень крупный (XL) | 30 | 50 | 500+ рабочих |

---

## План реализации

### Этап 1: Анализ данных (1-2 недели)
- [ ] Выгрузить детальные данные по должностям из itr_data_2025.json
- [ ] Классифицировать должности (обязательные/условные/исключаемые)
- [ ] Провести регрессионный анализ для каждой группы должностей
- [ ] Определить значимые факторы влияния

### Этап 2: Разработка модели (1-2 недели)
- [ ] Определить коэффициенты для каждой должности
- [ ] Валидировать модель на исторических данных
- [ ] Сравнить с текущими фактическими значениями
- [ ] Подготовить документацию по методике

### Этап 3: Обновление калькулятора (1 неделя)
- [ ] Добавить условные вопросы в интерфейс
- [ ] Обновить логику расчёта
- [ ] Добавить breakdown по категориям должностей
- [ ] Реализовать сохранение/экспорт расчётов

### Этап 4: Тестирование и валидация
- [ ] Протестировать на реальных проектах
- [ ] Собрать обратную связь от пользователей
- [ ] Скорректировать коэффициенты при необходимости

---

## Вопросы для обсуждения

1. **Какие должности точно обязательные?**
   - ГИП, Прораб, Инженер ПТО — очевидно
   - Инженер по ОТ — по законодательству
   - Что ещё?

2. **Какие условия добавить?**
   - Авто ✓
   - Иностранные рабочие ✓
   - Вахтовый метод ✓
   - Работа с опасными материалами?
   - Ночные смены?
   - Удалённость от города?

3. **Источники коэффициентов:**
   - Использовать фактические данные 2025?
   - Брать отраслевые нормативы (СНиПы, ГОСТы)?
   - Экспертные оценки руководителей?

4. **Как обрабатывать новые проекты?**
   - Проект только запускается — нет истории
   - Использовать средние по компании?
   - Давать диапазон (мин-макс)?

5. **Преподаватели и инструкторы:**
   - Подтверждаете полное исключение из расчёта?
   - Или перенести в отдельную категорию "Обучение" (вне ИТР)?

---

## Технические требования

### Новые поля в конфигурации

```json
{
  "position_groups": {
    "core": {
      "gip": { "min": 1, "max": 1, "per_workers": null },
      "prorab": { "min": 1, "max": null, "per_workers": { "S": 15, "M": 20, "L": 25, "XL": 30 } },
      "engineer_pto": { "min": 1, "max": null, "per_workers": { "S": 25, "M": 30, "L": 40, "XL": 50 } }
    },
    "conditional": {
      "driver": {
        "condition": "has_vehicles",
        "per_unit": 3,
        "unit_field": "vehicle_count"
      },
      "foreign_support": {
        "condition": "has_foreign_workers",
        "per_unit": 100,
        "unit_field": "foreign_worker_count"
      }
    },
    "excluded": ["teacher", "instructor"]
  }
}
```

### Новые поля в форме калькулятора

```typescript
interface CalculatorInput {
  projectName: string;
  workersCount: number;
  projectScale: 'S' | 'M' | 'L' | 'XL';
  workType: string[];

  // Условные факторы
  hasVehicles: boolean;
  vehicleCount?: number;

  hasForeignWorkers: boolean;
  foreignWorkerCount?: number;
  foreignWorkerLanguage?: string;

  isRotationalWork: boolean;
  hasDormitory?: boolean;
  dormitoryCapacity?: number;
}
```

---

## Следующие шаги

1. **Согласовать классификацию должностей** — какие обязательные, какие условные
2. **Определить список условных вопросов** — что спрашивать у пользователя
3. **Провести анализ данных** — выявить реальные зависимости
4. **Утвердить формулы расчёта** — до начала разработки
5. **Начать реализацию** — обновить калькулятор

---

*Документ создан: 2025-11-25*
*Статус: Черновик для обсуждения*
