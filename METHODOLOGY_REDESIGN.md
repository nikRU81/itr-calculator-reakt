# План переработки методики расчёта нормативов ИТР

## Проблемы текущей методики

### 1. Статистические проблемы
- **Единый норматив на все должности** — не учитывает специфику работы
- **Среднее арифметическое vs медиана** — разница 15.35 vs 9.62 говорит о выбросах
- **Не учитывается масштаб проекта** — малый проект ≠ крупный проект
- **Нет условных факторов** — все должности считаются безусловно

### 2. Методологические проблемы
- Отсутствует обоснование нормативов
- Нет разделения на обязательные и опциональные должности
- Не учитывается сезонность и фаза проекта

---

## Предлагаемая архитектура новой методики

### Уровень 1: Классификация должностей

```
┌─────────────────────────────────────────────────────────────┐
│                    ВСЕ ДОЛЖНОСТИ ИТР                        │
├─────────────────────────────────────────────────────────────┤
│  ОБЯЗАТЕЛЬНЫЕ (Core)     │  УСЛОВНЫЕ (Conditional)         │
│  - ГИП                   │  - Водители (если есть авто)    │
│  - Прораб                │  - Спец. по сопровождению       │
│  - Инженер ПТО           │    (если иностранные рабочие)   │
│  - Инженер по ОТ         │  - Переводчики (если нужны)     │
│  - Инженер по качеству   │  - Спец. по общежитиям          │
│                          │    (если вахта)                  │
├─────────────────────────────────────────────────────────────┤
│  ИСКЛЮЧАЕМЫЕ (Excluded)                                     │
│  - Преподаватели                                            │
│  - Инструкторы                                              │
└─────────────────────────────────────────────────────────────┘
```

### Уровень 2: Факторы влияния

| Фактор | Влияние | Как учитывать |
|--------|---------|---------------|
| Масштаб проекта | Высокое | Категории: S/M/L/XL с разными коэффициентами |
| Тип работ | Высокое | Строительство, монтаж, отделка и т.д. |
| Использование техники | Среднее | Наличие/отсутствие автопарка |
| Иностранные рабочие | Среднее | Нужен ли спец. по сопровождению |
| Вахтовый метод | Среднее | Нужны ли спец. по общежитиям |
| Фаза проекта | Низкое | Подготовка/активная фаза/завершение |

---

## Современные статистические методы

### 1. Регрессионный анализ
Вместо простого среднего использовать **множественную регрессию**:

```
ITR_позиция = β₀ + β₁×(Рабочие) + β₂×(Масштаб) + β₃×(Тип_работ) + ε
```

**Преимущества:**
- Учитывает несколько факторов одновременно
- Показывает значимость каждого фактора (p-value)
- Даёт доверительные интервалы

### 2. Квантильная регрессия
Для устойчивости к выбросам использовать **медианную регрессию (50-й квантиль)**:

```python
# Пример на Python
from statsmodels.regression.quantile_regression import QuantReg
model = QuantReg(y, X).fit(q=0.5)  # Медиана
```

### 3. Кластерный анализ
Автоматически выявить группы похожих проектов:

```
Кластер 1: Малые проекты (до 50 рабочих) — минимальный ИТР
Кластер 2: Средние проекты (50-200 рабочих) — стандартный ИТР
Кластер 3: Крупные проекты (200+ рабочих) — расширенный ИТР
```

### 4. Байесовский подход
Для должностей с малым количеством наблюдений:

```
Prior: Экспертная оценка (1 инженер на 30 рабочих)
Likelihood: Фактические данные
Posterior: Уточнённый норматив
```

---

## Структура условных вопросов

### Интерфейс калькулятора (новый)

```
┌─────────────────────────────────────────────────────────────┐
│  БАЗОВЫЕ ПАРАМЕТРЫ                                          │
├─────────────────────────────────────────────────────────────┤
│  Название проекта: [___________________]                    │
│  Численность рабочих: [_____]                               │
│  Масштаб проекта: ○ Малый ○ Средний ○ Крупный ○ Очень крупный │
│  Тип работ: □ Строительство □ Монтаж □ Отделка □ Другое    │
├─────────────────────────────────────────────────────────────┤
│  УСЛОВНЫЕ ФАКТОРЫ                                           │
├─────────────────────────────────────────────────────────────┤
│  Используется ли автотранспорт?     ○ Да ○ Нет             │
│  → Если да: количество единиц [___]                         │
│                                                             │
│  Привлекаются ли иностранные рабочие? ○ Да ○ Нет           │
│  → Если да: количество человек [___]                        │
│                                                             │
│  Вахтовый метод работы?             ○ Да ○ Нет             │
│  → Если да: проживание в общежитии? ○ Да ○ Нет             │
│                                                             │
│  Требуется ли обучение на площадке? ○ Да ○ Нет             │
│  (без учёта преподавателей — они исключены из расчёта)     │
└─────────────────────────────────────────────────────────────┘
```

---

## Формулы расчёта (предложение)

### Обязательные должности

| Должность | Формула | Минимум | Комментарий |
|-----------|---------|---------|-------------|
| ГИП | 1 на проект | 1 | Всегда 1, независимо от размера |
| Прораб | ceil(Рабочие / K_прораб[масштаб]) | 1 | K зависит от масштаба |
| Инженер ПТО | ceil(Рабочие / K_пто[масштаб]) | 1 | K зависит от масштаба |
| Инженер по ОТ | ceil(Рабочие / 50) | 1 | По нормативам ОТ |
| Инженер по качеству | ceil(Рабочие / K_кач[тип_работ]) | 1 | K зависит от типа работ |

### Условные должности

| Должность | Условие | Формула |
|-----------|---------|---------|
| Водитель | Авто = Да | ceil(Кол-во_авто / 3) |
| Механик | Авто = Да И Кол-во > 5 | ceil(Кол-во_авто / 10) |
| Спец. по сопровождению | Иностранцы = Да | ceil(Иностранцы / 100) |
| Переводчик | Иностранцы = Да И Язык ≠ RU | ceil(Иностранцы / 50) |
| Комендант общежития | Вахта = Да И Общежитие = Да | ceil(Проживающих / 100) |

### Коэффициенты по масштабу (K)

| Масштаб | K_прораб | K_пто | Описание |
|---------|----------|-------|----------|
| Малый (S) | 15 | 25 | До 50 рабочих |
| Средний (M) | 20 | 30 | 50-200 рабочих |
| Крупный (L) | 25 | 40 | 200-500 рабочих |
| Очень крупный (XL) | 30 | 50 | 500+ рабочих |

---

## План реализации

### Этап 1: Анализ данных (1-2 недели)
- [ ] Выгрузить детальные данные по должностям из itr_data_2025.json
- [ ] Классифицировать должности (обязательные/условные/исключаемые)
- [ ] Провести регрессионный анализ для каждой группы должностей
- [ ] Определить значимые факторы влияния

### Этап 2: Разработка модели (1-2 недели)
- [ ] Определить коэффициенты для каждой должности
- [ ] Валидировать модель на исторических данных
- [ ] Сравнить с текущими фактическими значениями
- [ ] Подготовить документацию по методике

### Этап 3: Обновление калькулятора (1 неделя)
- [ ] Добавить условные вопросы в интерфейс
- [ ] Обновить логику расчёта
- [ ] Добавить breakdown по категориям должностей
- [ ] Реализовать сохранение/экспорт расчётов

### Этап 4: Тестирование и валидация
- [ ] Протестировать на реальных проектах
- [ ] Собрать обратную связь от пользователей
- [ ] Скорректировать коэффициенты при необходимости

---

## Вопросы для обсуждения

1. **Какие должности точно обязательные?**
   - ГИП, Прораб, Инженер ПТО — очевидно
   - Инженер по ОТ — по законодательству
   - Что ещё?

2. **Какие условия добавить?**
   - Авто ✓
   - Иностранные рабочие ✓
   - Вахтовый метод ✓
   - Работа с опасными материалами?
   - Ночные смены?
   - Удалённость от города?

3. **Источники коэффициентов:**
   - Использовать фактические данные 2025?
   - Брать отраслевые нормативы (СНиПы, ГОСТы)?
   - Экспертные оценки руководителей?

4. **Как обрабатывать новые проекты?**
   - Проект только запускается — нет истории
   - Использовать средние по компании?
   - Давать диапазон (мин-макс)?

5. **Преподаватели и инструкторы:**
   - Подтверждаете полное исключение из расчёта?
   - Или перенести в отдельную категорию "Обучение" (вне ИТР)?

---

## Технические требования

### Новые поля в конфигурации

```json
{
  "position_groups": {
    "core": {
      "gip": { "min": 1, "max": 1, "per_workers": null },
      "prorab": { "min": 1, "max": null, "per_workers": { "S": 15, "M": 20, "L": 25, "XL": 30 } },
      "engineer_pto": { "min": 1, "max": null, "per_workers": { "S": 25, "M": 30, "L": 40, "XL": 50 } }
    },
    "conditional": {
      "driver": {
        "condition": "has_vehicles",
        "per_unit": 3,
        "unit_field": "vehicle_count"
      },
      "foreign_support": {
        "condition": "has_foreign_workers",
        "per_unit": 100,
        "unit_field": "foreign_worker_count"
      }
    },
    "excluded": ["teacher", "instructor"]
  }
}
```

### Новые поля в форме калькулятора

```typescript
interface CalculatorInput {
  projectName: string;
  workersCount: number;
  projectScale: 'S' | 'M' | 'L' | 'XL';
  workType: string[];

  // Условные факторы
  hasVehicles: boolean;
  vehicleCount?: number;

  hasForeignWorkers: boolean;
  foreignWorkerCount?: number;
  foreignWorkerLanguage?: string;

  isRotationalWork: boolean;
  hasDormitory?: boolean;
  dormitoryCapacity?: number;
}
```

---

## Следующие шаги

1. **Согласовать классификацию должностей** — какие обязательные, какие условные
2. **Определить список условных вопросов** — что спрашивать у пользователя
3. **Провести анализ данных** — выявить реальные зависимости
4. **Утвердить формулы расчёта** — до начала разработки
5. **Начать реализацию** — обновить калькулятор

---

*Документ создан: 2025-11-25*
*Статус: Черновик для обсуждения*
